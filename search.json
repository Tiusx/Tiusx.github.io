[{"title":"Linux服务器初始化设置用户和ssh公私钥登陆","path":"/2018/04/11/Linux服务器初始化设置用户和ssh公私钥登陆/","content":"当我们开始使用一个新的服务器的时候，首先一定要对服务器的登陆等做一些修改工作，笔者曾经就因为对服务器登陆安全没有重视，导致服务器数据全部丢失。接下来我们按照步骤，罗列出应该做的一些事情。 修改ssh端口号第一件事情： 修改ssh端口号： 之后加上一个端口比如说50000 vi /etc/ssh/sshd_config之后在port字段加上一个端口比如说50000，原来的端口号字段可能是被注释掉的，要先解除注释。 然后执行： 1service sshd restart 这个时候可能还要重新配置一下防火墙，开放50000端口，具体如何配置也可以参考这里的后半部分。但是目前，阿里云的服务器实测是不需要再配置防火墙的，但是需要去登陆到网页后台修改安全组。 之后就可以通过这样的方式登录了：(注意登录方式一定要写对) 1ssh root@115.29.102.81 -p 50000 创建用户这个时候我们还是用root进行操作，所以我们接下来要给自己创建一个账户，比如创建一个如下的用户： 12useradd xiaotaopasswd xiaotao 可以用&#96;ls -al &#x2F;home&#x2F;&#96;&#96;查看一下账户 对创建的这个用户增加sudo权限： 相关配置文件&#x2F;etc&#x2F;sudoers中，但是这个文件是只读的，所以要更改一下权限 1chmod u+w sudoers 然后进入这个文件在这里进行更改： 12root ALL=(ALL) ALLxiaotao ALL=(ALL) ALL 然后再改回权限： 1chmod u-w sudoers 注意一点，CentOS 7预设容许任何帐号透过ssh登入（也就是说自己根本不用改改，直接新建帐号登录即可），包括根和一般帐号，为了不受根帐号被黑客暴力入侵，我们必须禁止 root帐号的ssh功能，事实上root也没有必要ssh登入伺服器，因为只要使用su或sudo（当然需要输入root的密码）普通帐号便可以拥有root的权限。使用vim（或任何文本编辑器）开启的&#x2F; etc&#x2F; SSH&#x2F; sshd_config中，寻找： 1＃PermitRootLogin yes 修改： 1PermitRootLogin no 配置公私钥加密登录这一步骤要切换到自己新建的用户，不能再用 root 用户了，否则可能无法正常登陆。 很多时候以上所说的还是不够安全，为了更加安全方便，我们采用公私钥对称加密登录，简单的讲做法就是再客户端生成一把私钥一把公钥，私钥是在客户端的，公钥上传到服务端，对称加密进行登录。 在客户端先进到这个目录： 1cd ~/.ssh 生成公钥和私钥（实际上如果之前有的话就不用重新生成了） 1ssh-keygen -t rsa 接下来把公钥上传到服务端 1scp ~/.ssh/id_rsa.pub xiaotao@&lt;ssh_server_ip&gt;:~ 在服务端执行以下命令(如果没有相关的文件和文件夹要先进行创建，注意不要使用 sudo ) 1cat id_rsa.pub &gt;&gt; ～/.ssh/authorized_keys 配置服务器的&#x2F;etc&#x2F;ssh&#x2F;sshd_config，下面是一些建议的配置： 1234567891011121314151617vim /etc/ssh/sshd_config# 禁用root账户登录，非必要，但为了安全性，请配置PermitRootLogin no# 是否让 sshd 去检查用户家目录或相关档案的权限数据，# 这是为了担心使用者将某些重要档案的权限设错，可能会导致一些问题所致。# 例如使用者的 ~.ssh/ 权限设错时，某些特殊情况下会不许用户登入StrictModes no# 是否允许用户自行使用成对的密钥系统进行登入行为，仅针对 version 2。# 至于自制的公钥数据就放置于用户家目录下的 .ssh/authorized_keys 内RSAAuthentication yesPubkeyAuthentication yesAuthorizedKeysFile %h/.ssh/authorized_keys#有了证书登录了，就禁用密码登录吧，安全要紧PasswordAuthentication no 然后不要忘记 sudo service sshd restart 一般来讲，这样就算是成功了，我们可以在客户端尝试： 1ssh -i ~/.ssh/id_rsa remote_username@remote_ip 如果不行，可能是服务端或客户端相关 .ssh 文件权限不对，可以进行如下尝试： 123456服务端chown -R 0700 ~/.sshchown -R 0644 ~/.ssh/authorized_keys客户端改一下chmod 600 id_rsa","tags":["Linux","ssh"]},{"title":"友链","path":"/friends/index.html","content":"友链关于小伙伴们如果宇宙中真有什么终极的逻辑，那就是我们终有一天会在舰桥上重逢，直到生命终结。 加入友链 您的网站应满足以下全部条件： 安全合规：合法的、非营利性、无木马植入的 HTTPS 站点。 非空壳网站：网站内发布至少 五篇 原创文章，内容题材不限。 我已满足全部条件，快告诉我如何交换友链！如果您没有满足上述条件，即时提交了申请也不会通过哦～第一步：新建 Issue新建 GitHub Issue 按照模板格式填写并提交。为了提高图片加载速度，建议优化头像：打开 压缩图 上传自己的头像，将图片尺寸调整到 144px 后下载。将压缩后的图片上传到 去不图床 或者其它稳定的图床并使用此图片链接作为头像。第二步：添加友链并等待管理员审核请添加本站到您的友链中：1234title: xxxurl: https://xxx.comavatar: screenshot: 待管理员审核通过，添加了 active 标签后，回来刷新即可生效。如果您需要更新自己的友链，请直接修改 issue 内容，大约 3 分钟内生效，无需等待博客重新部署。"}]